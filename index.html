<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Don't Hype Me - RSS Feed Explorer</title>
  <style>
    :root {
      --bg: #0f1117;
      --surface: #181a20;
      --surface-hover: #1e2028;
      --border: #2a2d37;
      --text: #e1e4ed;
      --text-muted: #8b8fa3;
      --accent: #f59e0b;
      --accent-dim: rgba(245, 158, 11, 0.12);
      --link: #60a5fa;
      --tag-tech: #818cf8;
      --tag-yt: #f87171;
      --tag-reddit: #fb923c;
      --tag-news: #34d399;
      --tag-uncategorized: #a78bfa;
      --radius: 8px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }

    header {
      border-bottom: 1px solid var(--border);
      padding: 2rem 1.5rem 1.5rem;
      max-width: 960px;
      margin: 0 auto;
    }

    header h1 {
      font-size: 1.75rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      margin-bottom: 0.25rem;
    }

    header h1 span { color: var(--accent); }

    header p {
      color: var(--text-muted);
      font-size: 0.95rem;
      max-width: 600px;
    }

    .stats {
      display: flex;
      gap: 1.5rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .stat {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .stat strong {
      color: var(--text);
      font-size: 1.2rem;
      display: block;
    }

    .controls {
      max-width: 960px;
      margin: 1.25rem auto 0;
      padding: 0 1.5rem;
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .search-box {
      flex: 1;
      min-width: 200px;
      position: relative;
    }

    .search-box input {
      width: 100%;
      padding: 0.6rem 0.75rem 0.6rem 2.25rem;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text);
      font-size: 0.9rem;
      outline: none;
      transition: border-color 0.15s;
    }

    .search-box input:focus { border-color: var(--accent); }

    .search-box::before {
      content: "\1F50D";
      position: absolute;
      left: 0.7rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.85rem;
      opacity: 0.5;
    }

    .filter-btn {
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text-muted);
      font-size: 0.82rem;
      cursor: pointer;
      transition: all 0.15s;
      font-weight: 500;
    }

    .filter-btn:hover { border-color: var(--accent); color: var(--text); }
    .filter-btn.active { background: var(--accent-dim); border-color: var(--accent); color: var(--accent); }

    main {
      max-width: 960px;
      margin: 0 auto;
      padding: 1.25rem 1.5rem 3rem;
    }

    .category {
      margin-bottom: 1.5rem;
    }

    .category-header {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.75rem 0;
      cursor: pointer;
      user-select: none;
      border-bottom: 1px solid var(--border);
      margin-bottom: 0.5rem;
    }

    .category-header:hover .category-name { color: var(--accent); }

    .chevron {
      font-size: 0.7rem;
      transition: transform 0.2s;
      color: var(--text-muted);
      width: 1rem;
      text-align: center;
    }

    .category.collapsed .chevron { transform: rotate(-90deg); }

    .category-tag {
      font-size: 0.7rem;
      padding: 0.15rem 0.5rem;
      border-radius: 99px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .tag-tech { background: rgba(129,140,248,0.15); color: var(--tag-tech); }
    .tag-youtube { background: rgba(248,113,113,0.15); color: var(--tag-yt); }
    .tag-reddit { background: rgba(251,146,60,0.15); color: var(--tag-reddit); }
    .tag-news { background: rgba(52,211,153,0.15); color: var(--tag-news); }
    .tag-uncategorized { background: rgba(167,139,250,0.15); color: var(--tag-uncategorized); }

    .category-name {
      font-weight: 600;
      font-size: 1.05rem;
      transition: color 0.15s;
    }

    .category-count {
      color: var(--text-muted);
      font-size: 0.8rem;
      margin-left: auto;
    }

    .category-annotation {
      font-size: 0.82rem;
      color: var(--text-muted);
      padding: 0.25rem 0 0.5rem 1.6rem;
      font-style: italic;
    }

    .feed-list {
      list-style: none;
    }

    .category.collapsed .feed-list,
    .category.collapsed .category-annotation { display: none; }

    .feed-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.6rem 0.5rem 0.6rem 1.6rem;
      border-radius: var(--radius);
      transition: background 0.1s;
    }

    .feed-item:hover { background: var(--surface-hover); }

    .feed-icon {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      background: var(--surface);
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      flex-shrink: 0;
      margin-top: 2px;
      overflow: hidden;
    }

    .feed-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .feed-info { flex: 1; min-width: 0; }

    .feed-name {
      font-weight: 500;
      font-size: 0.92rem;
    }

    .feed-annotation {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 0.1rem;
    }

    .feed-url {
      font-size: 0.75rem;
      color: var(--text-muted);
      opacity: 0.6;
      text-decoration: none;
      word-break: break-all;
      display: block;
      margin-top: 0.15rem;
      transition: opacity 0.15s;
    }

    .feed-url:hover { opacity: 1; color: var(--link); }

    .feed-badges {
      display: flex;
      gap: 0.35rem;
      flex-shrink: 0;
      margin-top: 4px;
    }

    .badge {
      font-size: 0.65rem;
      padding: 0.1rem 0.4rem;
      border-radius: 4px;
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text-muted);
      white-space: nowrap;
    }

    .no-results {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-muted);
    }

    .no-results p { font-size: 0.95rem; }

    footer {
      text-align: center;
      padding: 1.5rem;
      color: var(--text-muted);
      font-size: 0.8rem;
      border-top: 1px solid var(--border);
      max-width: 960px;
      margin: 0 auto;
    }

    footer a { color: var(--link); text-decoration: none; }
    footer a:hover { text-decoration: underline; }

    .hidden { display: none !important; }

    @media (max-width: 600px) {
      header, .controls, main { padding-left: 1rem; padding-right: 1rem; }
      header h1 { font-size: 1.35rem; }
      .feed-item { padding-left: 0.5rem; }
      .category-annotation { padding-left: 0.5rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1><span>Don't Hype Me</span> &mdash; RSS Feed Explorer</h1>
    <p>A curated collection of RSS feeds spanning tech, security, AI research, YouTube channels, Reddit communities, and news outlets.</p>
    <div class="stats" id="stats"></div>
  </header>
  <div class="controls">
    <div class="search-box">
      <input type="text" id="search" placeholder="Filter feeds..." autocomplete="off" />
    </div>
    <button class="filter-btn active" data-filter="all">All</button>
  </div>
  <main id="main"></main>
  <footer>
    <p>
      OPML source: <a href="donthypeme-feeds.opml">donthypeme-feeds.opml</a>
      &middot; Part of the <a href="https://github.com/schmug/opml-backup">opml-backup</a> project
    </p>
  </footer>

<script>
// ── Annotations ──────────────────────────────────────────────────────
// Human-written descriptions for categories and notable feeds.
const categoryAnnotations = {
  "Tech": "Technology, AI research, cybersecurity, hacking culture, and privacy. The broadest and deepest category.",
  "YouTube": "Video channels covering AI, investigative journalism, science, music production, and culture.",
  "Reddit": "Subreddit feeds for sysadmins, cybersecurity professionals, and internet humor.",
  "News": "Mainstream and investigative news outlets, plus North Carolina legislative documents.",
  "Uncategorized": "Feeds living outside any category folder in the OPML."
};

const feedAnnotations = {
  // Tech
  "Hacker News": "Y Combinator's community-driven tech news aggregator.",
  "Ars Technica - All content": "In-depth tech journalism since 1998.",
  "The Verge": "Technology, science, art, and culture coverage from Vox Media.",
  "WIRED": "Long-form tech and culture journalism.",
  "TechCrunch": "Startup and venture capital focused tech news.",
  "MIT Technology Review": "MIT's publication on emerging technologies and their impact.",
  "Simon Willison\u2019s Weblog": "Creator of Datasette; prolific writer on AI, Python, and open data.",
  "karpathy": "Andrej Karpathy \u2014 former Tesla AI director, OpenAI founding member. Deep learning insights.",
  "One Useful Thing": "Ethan Mollick (Wharton professor) on practical AI use in work and education.",
  "Anthropic Engineering Blog": "Technical deep-dives from the makers of Claude.",
  "Anthropic Research": "Research papers and findings from Anthropic's safety-focused AI lab.",
  "Anthropic Frontier Red Team Blog": "Adversarial testing and AI safety evaluation insights.",
  "Anthropic News": "Company announcements and product updates from Anthropic.",
  "\"anthropic\" - Google News": "Google News alerts for Anthropic mentions across the web.",
  "AI": "Google's official AI blog \u2014 product launches, research, and Gemini updates.",
  "Dan Shapiro\u2019s Blog": "Tech entrepreneur, former CEO of Glowforge.",
  "Dries Buytaert": "Creator of Drupal; writes on open source and the open web.",
  "darkreading": "Enterprise cybersecurity news and analysis.",
  "DataBreaches.Net": "Tracking and reporting data breaches worldwide.",
  "Help Net Security": "Information security news, reviews, and insights.",
  "The DFIR Report": "Real-world intrusion analysis and threat intelligence reports.",
  "Articles - ~this week in security~": "Weekly security news roundup.",
  "Phrack Magazine": "Legendary hacker e-zine, running since 1985.",
  "2600 - 2600: The Hacker Quarterly": "The hacker quarterly \u2014 hacking culture since 1984.",
  "Cyberpunk Librarian": "Intersection of libraries, technology, and digital culture.",
  "PogoWasRight.org": "Privacy and data protection law commentary.",
  "The Opt Out Project": "Guides and resources for digital privacy and opting out of data collection.",
  "Techlore": "Privacy and security education for everyday users.",
  "Nate's Substack": "Tech industry commentary and analysis.",
  "So long and thanks for all the fish.": "Jordan Kasper's blog on web development and tech.",
  "Geoffrey Huntley": ".NET developer and open-source contributor.",

  // YouTube
  "404 Media": "Investigative tech journalism from former VICE Motherboard reporters.",
  "Anthropic": "Official Anthropic YouTube \u2014 demos, talks, and research presentations.",
  "Benn Jordan": "Musician and producer exploring audio tech, AI music, and creative process.",
  "CHUPPL": "Tech and science content creator.",
  "fern": "Video essays on culture, technology, and the internet.",
  "Jack Rhysider": "Creator of Darknet Diaries \u2014 true stories from the dark side of the internet.",
  "Kurzgesagt \u2013 In a Nutshell": "Beautifully animated science and philosophy explainers.",
  "Lauran Irion": "Content on tech, productivity, and digital life.",
  "Manus AI": "AI agent platform demos and updates.",
  "MegaLag": "Gaming and internet culture content.",
  "OpenAI": "Official OpenAI channel \u2014 product demos, research talks, and announcements.",
  "Reject Convenience": "Exploring the hidden costs of modern tech convenience.",
  "TED": "TED Talks \u2014 ideas worth spreading across every domain.",
  "The Ezra Klein Show": "In-depth interviews on politics, policy, and technology.",
  "Theo - t3\u2024gg": "Web development, TypeScript, and React ecosystem commentary.",
  "Vox": "Explanatory journalism in video form.",

  // Reddit
  "ashes to ashes, rust to rust": "r/iiiiiiitttttttttttt \u2014 IT humor and memes.",
  "cybersecurity": "r/cybersecurity \u2014 News, discussion, and career advice.",
  "DepthHub: A jumping-off point for deeply-involved subreddits": "r/DepthHub \u2014 Curated high-quality long-form Reddit comments.",
  "K-12 Systems Administrators": "r/k12sysadmin \u2014 School IT administrators sharing knowledge.",
  "People Who Ate The Onion": "r/AteTheOnion \u2014 People mistaking satire for real news.",
  "Sysadmin": "r/sysadmin \u2014 The largest community for systems administrators.",

  // News
  "English - VICE": "VICE's English-language news and features.",
  "NCGA Joint Legislative Oversight Committee on Information Technology Documents": "NC state legislature IT oversight \u2014 public government documents.",
  "ProPublica": "Nonprofit investigative journalism in the public interest.",
  "TheHill.com Just In": "U.S. political news from Capitol Hill.",
  "Top stories - Google News": "Google News top stories aggregation.",
  "Vox": "Explanatory journalism covering policy, politics, and culture."
};

// ── Badge classification ─────────────────────────────────────────────
const feedBadges = {
  "Hacker News": ["aggregator"],
  "Ars Technica - All content": ["journalism"],
  "The Verge": ["journalism"],
  "WIRED": ["journalism"],
  "TechCrunch": ["journalism"],
  "MIT Technology Review": ["journalism"],
  "Simon Willison\u2019s Weblog": ["personal", "AI"],
  "karpathy": ["personal", "AI"],
  "One Useful Thing": ["personal", "AI"],
  "Anthropic Engineering Blog": ["AI", "engineering"],
  "Anthropic Research": ["AI", "research"],
  "Anthropic Frontier Red Team Blog": ["AI", "security"],
  "Anthropic News": ["AI"],
  "AI": ["AI"],
  "darkreading": ["security"],
  "DataBreaches.Net": ["security", "privacy"],
  "Help Net Security": ["security"],
  "The DFIR Report": ["security", "research"],
  "Phrack Magazine": ["security", "hacking"],
  "2600 - 2600: The Hacker Quarterly": ["security", "hacking"],
  "PogoWasRight.org": ["privacy", "law"],
  "The Opt Out Project": ["privacy"],
  "Techlore": ["privacy"],
  "ProPublica": ["investigative"],
  "404 Media": ["investigative"],
  "Jack Rhysider": ["security", "podcast"],
  "Kurzgesagt \u2013 In a Nutshell": ["science"],
  "TED": ["talks"],
  "The Ezra Klein Show": ["podcast", "politics"],
  "Theo - t3\u2024gg": ["webdev"],
};

// ── Parse OPML (embedded) ────────────────────────────────────────────
const opmlXml = `<?xml version="1.0" encoding="UTF-8"?>
<opml version="2.0">
  <head>
    <title>Don't Hype Me RSS Feeds</title>
  </head>
  <body>
    <outline type="rss" text="Geoffrey Huntley" xmlUrl="https://ghuntley.com/rss/" />
    <outline text="Tech">
      <outline type="rss" text="&quot;anthropic&quot; - Google News" xmlUrl="https://news.google.com/rss/search?q=anthropic" />
      <outline type="rss" text="2600 - 2600: The Hacker Quarterly" xmlUrl="http://www.2600.com/rss.xml" />
      <outline type="rss" text="AI" xmlUrl="https://blog.google/technology/ai/rss/" />
      <outline type="rss" text="Anthropic Engineering Blog" xmlUrl="https://raw.githubusercontent.com/Olshansk/rss-feeds/main/feeds/feed_anthropic_engineering.xml" />
      <outline type="rss" text="Anthropic Frontier Red Team Blog" xmlUrl="https://raw.githubusercontent.com/Olshansk/rss-feeds/main/feeds/feed_anthropic_red.xml" />
      <outline type="rss" text="Anthropic News" xmlUrl="https://raw.githubusercontent.com/Olshansk/rss-feeds/main/feeds/feed_anthropic_news.xml" />
      <outline type="rss" text="Anthropic Research" xmlUrl="https://raw.githubusercontent.com/Olshansk/rss-feeds/main/feeds/feed_anthropic_research.xml" />
      <outline type="rss" text="Ars Technica - All content" xmlUrl="https://feeds.arstechnica.com/arstechnica/index" />
      <outline type="rss" text="Articles - ~this week in security~" xmlUrl="https://this.weekinsecurity.com/articles/rss/" />
      <outline type="rss" text="Cyberpunk Librarian" xmlUrl="https://cyberpunklibrarian.com/feed/" />
      <outline type="rss" text="Dan Shapiro&apos;s Blog" xmlUrl="https://www.danshapiro.com/blog/feed/" />
      <outline type="rss" text="darkreading" xmlUrl="https://www.darkreading.com/rss.xml" />
      <outline type="rss" text="DataBreaches.Net" xmlUrl="https://databreaches.net/feed/" />
      <outline type="rss" text="Dries Buytaert" xmlUrl="https://dri.es/rss.xml" />
      <outline type="rss" text="Hacker News" xmlUrl="https://news.ycombinator.com/rss" />
      <outline type="rss" text="Help Net Security" xmlUrl="https://www.helpnetsecurity.com/feed/" />
      <outline type="rss" text="karpathy" xmlUrl="https://karpathy.bearblog.dev/rss/" />
      <outline type="rss" text="MIT Technology Review" xmlUrl="https://www.technologyreview.com/feed/" />
      <outline type="rss" text="Nate's Substack" xmlUrl="https://natesnewsletter.substack.com/feed.xml" />
      <outline type="rss" text="One Useful Thing" xmlUrl="https://www.oneusefulthing.org/feed" />
      <outline type="rss" text="Phrack Magazine" xmlUrl="http://iosifache.me/feeds/phrack.xml" />
      <outline type="rss" text="PogoWasRight.org" xmlUrl="https://pogowasright.org/feed/" />
      <outline type="rss" text="Simon Willison&apos;s Weblog" xmlUrl="https://simonwillison.net/atom/everything/" />
      <outline type="rss" text="So long and thanks for all the fish." xmlUrl="https://jordankasper.com/rss" />
      <outline type="rss" text="TechCrunch" xmlUrl="https://techcrunch.com/feed/" />
      <outline type="rss" text="Techlore" xmlUrl="https://techlore.tech/rss/" />
      <outline type="rss" text="The DFIR Report" xmlUrl="https://thedfirreport.com/feed/" />
      <outline type="rss" text="The Opt Out Project" xmlUrl="https://www.optoutproject.net/feed" />
      <outline type="rss" text="The Verge" xmlUrl="https://www.theverge.com/rss/index.xml" />
      <outline type="rss" text="WIRED" xmlUrl="Https://wired.com/feed/rss" />
    </outline>
    <outline text="YouTube">
      <outline type="rss" text="404 Media" xmlUrl="https://www.youtube.com/feeds/videos.xml?channel_id=UC7YMZb0X_W06ToOazhFuXIQ" />
      <outline type="rss" text="Anthropic" xmlUrl="https://www.youtube.com/feeds/videos.xml?channel_id=UCrDwWp7EBBv4NwvScIpBDOA" />
      <outline type="rss" text="Benn Jordan" xmlUrl="https://www.youtube.com/feeds/videos.xml?channel_id=UCshObcm-nLhbu8MY50EZ5Ng" />
      <outline type="rss" text="CHUPPL" xmlUrl="https://www.youtube.com/feeds/videos.xml?channel_id=UCizJl3TxBunh-LzpwyPYg0w" />
      <outline type="rss" text="fern" xmlUrl="https://www.youtube.com/feeds/videos.xml?channel_id=UCODHrzPMGbNv67e84WDZhQQ" />
      <outline type="rss" text="Jack Rhysider" xmlUrl="https://www.youtube.com/feeds/videos.xml?channel_id=UCMIqrmh2lMdzhlCPK5ahsAg" />
      <outline type="rss" text="Kurzgesagt – In a Nutshell" xmlUrl="https://www.youtube.com/feeds/videos.xml?channel_id=UCsXVk37bltHxD1rDPwtNM8Q" />
      <outline type="rss" text="Lauran Irion" xmlUrl="https://www.youtube.com/feeds/videos.xml?channel_id=UC2S4560XyLjhrj1P0e7s6zA" />
      <outline type="rss" text="Manus AI" xmlUrl="https://www.youtube.com/feeds/videos.xml?channel_id=UCQgFQdqiFQ_LfFBGP6z9dqQ" />
      <outline type="rss" text="MegaLag" xmlUrl="https://www.youtube.com/feeds/videos.xml?channel_id=UCwhB8cJTSLxyubnKSS-PLJg" />
      <outline type="rss" text="OpenAI" xmlUrl="https://www.youtube.com/feeds/videos.xml?channel_id=UCXZCJLdBC09xxGZ6gcdrc6A" />
      <outline type="rss" text="Reject Convenience" xmlUrl="https://www.youtube.com/feeds/videos.xml?channel_id=UC-ufRLYrXxrIEApGn9VG5pQ" />
      <outline type="rss" text="TED" xmlUrl="https://www.youtube.com/feeds/videos.xml?channel_id=UCAuUUnT6oDeKwE6v1NGQxug" />
      <outline type="rss" text="The Ezra Klein Show" xmlUrl="https://www.youtube.com/feeds/videos.xml?channel_id=UCnxuOd8obvLLtf5_-YKFbiQ" />
      <outline type="rss" text="Theo - t3.gg" xmlUrl="https://www.youtube.com/feeds/videos.xml?channel_id=UCbRP3c757lWg9M-U7TyEkXA" />
      <outline type="rss" text="Vox" xmlUrl="https://www.youtube.com/feeds/videos.xml?channel_id=UCLXo7UDZvByw2ixzpQCufnA" />
    </outline>
    <outline text="Reddit">
      <outline type="rss" text="ashes to ashes, rust to rust" xmlUrl="https://old.reddit.com/r/iiiiiiitttttttttttt/.rss" />
      <outline type="rss" text="cybersecurity" xmlUrl="https://old.reddit.com/r/cybersecurity/.rss" />
      <outline type="rss" text="DepthHub: A jumping-off point for deeply-involved subreddits" xmlUrl="https://old.reddit.com/r/DepthHub/.rss" />
      <outline type="rss" text="K-12 Systems Administrators" xmlUrl="https://old.reddit.com/r/k12sysadmin/.rss" />
      <outline type="rss" text="People Who Ate The Onion" xmlUrl="https://old.reddit.com/r/AteTheOnion/.rss" />
      <outline type="rss" text="Sysadmin" xmlUrl="https://old.reddit.com/r/sysadmin/.rss" />
    </outline>
    <outline text="News">
      <outline type="rss" text="English - VICE" xmlUrl="https://www.vice.com/en/feed/?locale=en_us" />
      <outline type="rss" text="NCGA Joint Legislative Oversight Committee on Information Technology Documents" xmlUrl="https://www.ncleg.gov/Documents/RSS/4/" />
      <outline type="rss" text="ProPublica" xmlUrl="https://www.propublica.org/feeds/propublica/main" />
      <outline type="rss" text="TheHill.com Just In" xmlUrl="https://thehill.com/homenews/feed/" />
      <outline type="rss" text="Top stories - Google News" xmlUrl="https://news.google.com/rss" />
      <outline type="rss" text="Vox" xmlUrl="https://vox.com/rss/index.xml" />
    </outline>
  </body>
</opml>`;

function parseOPML() {
  const parser = new DOMParser();
  const doc = parser.parseFromString(opmlXml, "text/xml");
  const body = doc.querySelector("body");
  const categories = [];
  let totalFeeds = 0;

  for (const child of body.children) {
    if (child.getAttribute("type") === "rss") {
      // top-level uncategorized feed
      let uncat = categories.find(c => c.name === "Uncategorized");
      if (!uncat) {
        uncat = { name: "Uncategorized", feeds: [] };
        categories.unshift(uncat);
      }
      uncat.feeds.push({
        name: child.getAttribute("text"),
        url: child.getAttribute("xmlUrl")
      });
      totalFeeds++;
    } else {
      const cat = { name: child.getAttribute("text"), feeds: [] };
      for (const feed of child.children) {
        cat.feeds.push({
          name: feed.getAttribute("text"),
          url: feed.getAttribute("xmlUrl")
        });
        totalFeeds++;
      }
      categories.push(cat);
    }
  }
  return { categories, totalFeeds };
}

function tagClass(catName) {
  const map = { Tech: "tag-tech", YouTube: "tag-youtube", Reddit: "tag-reddit", News: "tag-news", Uncategorized: "tag-uncategorized" };
  return map[catName] || "tag-tech";
}

function domainFromUrl(url) {
  try { return new URL(url).hostname.replace("www.", ""); } catch { return ""; }
}

function faviconUrl(feedUrl) {
  const domain = domainFromUrl(feedUrl);
  if (!domain) return null;
  return `https://www.google.com/s2/favicons?domain=${domain}&sz=32`;
}

function escapeHtml(str) {
  const el = document.createElement("span");
  el.textContent = str;
  return el.innerHTML;
}

function render(categories, filter, query) {
  const main = document.getElementById("main");
  let html = "";
  let visibleCount = 0;

  for (const cat of categories) {
    if (filter !== "all" && cat.name !== filter) continue;

    const matchingFeeds = cat.feeds.filter(f => {
      if (!query) return true;
      const q = query.toLowerCase();
      const annotation = (feedAnnotations[f.name] || "").toLowerCase();
      return f.name.toLowerCase().includes(q) || f.url.toLowerCase().includes(q) || annotation.includes(q);
    });

    if (matchingFeeds.length === 0) continue;
    visibleCount += matchingFeeds.length;

    const annotation = categoryAnnotations[cat.name] || "";
    html += `<div class="category" data-cat="${escapeHtml(cat.name)}">`;
    html += `<div class="category-header" onclick="this.parentElement.classList.toggle('collapsed')">`;
    html += `<span class="chevron">&#9660;</span>`;
    html += `<span class="category-tag ${tagClass(cat.name)}">${escapeHtml(cat.name)}</span>`;
    html += `<span class="category-name">${escapeHtml(cat.name)}</span>`;
    html += `<span class="category-count">${matchingFeeds.length} feed${matchingFeeds.length !== 1 ? "s" : ""}</span>`;
    html += `</div>`;
    if (annotation) {
      html += `<div class="category-annotation">${escapeHtml(annotation)}</div>`;
    }
    html += `<ul class="feed-list">`;

    for (const feed of matchingFeeds) {
      const fav = faviconUrl(feed.url);
      const ann = feedAnnotations[feed.name] || "";
      const badges = feedBadges[feed.name] || [];
      html += `<li class="feed-item">`;
      html += `<div class="feed-icon">${fav ? `<img src="${fav}" alt="" loading="lazy" onerror="this.parentElement.textContent='&#128225;'">` : "&#128225;"}</div>`;
      html += `<div class="feed-info">`;
      html += `<div class="feed-name">${escapeHtml(feed.name)}</div>`;
      if (ann) html += `<div class="feed-annotation">${escapeHtml(ann)}</div>`;
      html += `<a class="feed-url" href="${escapeHtml(feed.url)}" target="_blank" rel="noopener">${escapeHtml(feed.url)}</a>`;
      html += `</div>`;
      if (badges.length) {
        html += `<div class="feed-badges">`;
        for (const b of badges) html += `<span class="badge">${escapeHtml(b)}</span>`;
        html += `</div>`;
      }
      html += `</li>`;
    }

    html += `</ul></div>`;
  }

  if (visibleCount === 0) {
    html = `<div class="no-results"><p>No feeds match your search.</p></div>`;
  }

  main.innerHTML = html;
}

function renderStats(categories, totalFeeds) {
  const catCount = categories.length;
  const statsEl = document.getElementById("stats");
  statsEl.innerHTML = `
    <div class="stat"><strong>${totalFeeds}</strong> feeds</div>
    <div class="stat"><strong>${catCount}</strong> categories</div>
    <div class="stat"><strong>OPML 2.0</strong> format</div>
  `;
}

function init() {
  const { categories, totalFeeds } = parseOPML();
  renderStats(categories, totalFeeds);

  // Build filter buttons
  const controls = document.querySelector(".controls");
  for (const cat of categories) {
    const btn = document.createElement("button");
    btn.className = "filter-btn";
    btn.dataset.filter = cat.name;
    btn.textContent = cat.name;
    controls.appendChild(btn);
  }

  let activeFilter = "all";
  let currentQuery = "";

  controls.addEventListener("click", e => {
    if (!e.target.classList.contains("filter-btn")) return;
    controls.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
    e.target.classList.add("active");
    activeFilter = e.target.dataset.filter;
    render(categories, activeFilter, currentQuery);
  });

  document.getElementById("search").addEventListener("input", e => {
    currentQuery = e.target.value.trim();
    render(categories, activeFilter, currentQuery);
  });

  render(categories, activeFilter, currentQuery);
}

init();
</script>
</body>
</html>
